<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1,user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>공장 시뮬레이션</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#fff; }
    .content { padding:20px; text-align:center; }
    #three-container { width:100%; height:600px; background:#eee; display:block; }
    .back-button { position:fixed; bottom:20px; right:20px; background:#007BFF; color:#fff;
      border:none; border-radius:6px; padding:12px 18px; font-size:16px;cursor:pointer;
      box-shadow:0 4px 8px rgba(0,123,255,0.3); }
    .back-button:hover { opacity:0.9; }
  </style>
</head>
<body>
  <div class="content">
    <h1>공장 시뮬레이션</h1>
    <p>3D 로봇 모델과 공장 구조가 표시됩니다.</p>
  </div>
  <div id="three-container"></div>
  <button class="back-button" onclick="goBack()">처음으로</button>

  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

  <script>
    function goBack(){ window.location.href = 'index.html'; }

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/600,0.1,1000);
    camera.position.set(3,3,5);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth,600);
    document.getElementById('three-container').appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // 조명 설정
    const hemi = new THREE.HemisphereLight(0xffffff,0x444444,1.2); scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff,0.8); dir.position.set(5,10,7); scene.add(dir);

    // 바닥
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(20,20),
      new THREE.MeshStandardMaterial({color:0xcccccc})
    );
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // 공장 구조물 (기둥)
    const colMat = new THREE.MeshStandardMaterial({color:0x888888});
    [-5,5].forEach(x=>{
      [-5,5].forEach(z=>{
        const col = new THREE.Mesh(new THREE.CylinderGeometry(0.1,0.1,3,16), colMat);
        col.position.set(x,1.5,z);
        scene.add(col);
      });
    });

    // 로봇 GLTF 모델 로딩 (RobotExpressive)
    const loader = new THREE.GLTFLoader();
    loader.load(
      'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/RobotExpressive/glTF/RobotExpressive.gltf',
      gltf => {
        const robot = gltf.scene;
        robot.scale.set(0.4,0.4,0.4);
        robot.position.set(0,0,0);
        robot.rotation.y = Math.PI;  // 정면으로 향하도록
        scene.add(robot);
      },
      undefined,
      error => console.error('로봇 모델 로딩 실패:', error)
    );

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene,camera);
    }
    animate();

    window.addEventListener('resize',()=>{
      camera.aspect = window.innerWidth/600;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth,600);
    });
  </script>
</body>
</html>
