<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>공장 시뮬레이션</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: fixed;
      top: 0; left: 0;
    }
    h1, p {
      text-align: center;
      margin: 0;
      position: absolute;
      width: 100%;
      left: 0;
      z-index: 10;
      color: #000000;
      background: rgba(255,255,255,0.7);
    }
    h1 {
      top: 20px;
      font-size: 2rem;
      font-weight: bold;
    }
    p {
      top: 65px;
      font-size: 1.1rem;
    }
    #canvas-container {
      width: 95vw;
      height: 90vh;         /* 높이 줄임 */
      background: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      top: 5vh;              /* 상단에서 5% 여백 적용 */
      left: 0;
      right: 0;
      margin: 0 auto;
    }
    #home-button {
      position:fixed; bottom:20px; right:20px;
      padding:12px 20px; background:#007BFF; color:#fff;
      border:none; border-radius:5px; cursor:pointer;
    }
    #home-button:hover { opacity:0.9; }

    /* 톱니바퀴 버튼 스타일 */
    #settings-btn {
      position: fixed;
      top: 20px;
      right: 30px;
      background: none;
      border: none;
      padding: 0;
      z-index: 20;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #settings-btn svg {
      width: 28px;
      height: 28px;
    }

    /* 설정 팝업 스타일 */
    #settings-popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.4);
      z-index: 100;
      align-items: center;
      justify-content: center;
      flex-direction: column; /* 팝업이 중앙에 오도록 flex 적용 */
    }
    #settings-popup .popup-content {
      background: #fff;
      border-radius: 12px;
      padding: 32px 24px;
      box-shadow: 0 4px 24px #0002;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 220px;
    }
    #settings-popup h2 {
      margin-bottom: 24px;
      color: #007BFF;
      font-size: 1.3rem;
    }
    .setting-btn {
      margin: 8px 0;
      padding: 12px 32px;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    .setting-btn:hover {
      background: #0056b3;
    }
    #close-popup {
      margin-top: 18px;
      padding: 8px 24px;
      background: #eee;
      color: #007BFF;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
    }
    #close-popup:hover {
      background: #c82333;
    }
  </style>
</head>
<body>
  <h1>공장 시뮬레이션</h1>
  <p>3D 로봇 모델과 공장 구조물이 표시됩니다.</p>
  <div id="canvas-container"></div>
  <button id="home-button" onclick="location.href='index.html'">처음으로</button>
  <!-- 톱니바퀴 버튼 -->
  <button id="settings-btn" aria-label="설정">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="10" stroke="#007BFF" stroke-width="2" fill="#fff"/>
      <path d="M12 8v4l3 2" stroke="#007BFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="12" cy="12" r="1.5" fill="#007BFF"/>
    </svg>
  </button>
  <!-- 설정 팝업 -->
  <div id="settings-popup">
    <div class="popup-content">
      <h2>설정</h2>
      <button class="setting-btn">설정 버튼 1</button>
      <button class="setting-btn">설정 버튼 2</button>
      <button id="close-popup">닫기</button>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/GLTFLoader.js';

    const scene = new THREE.Scene();

    const width = window.innerWidth * 0.95;
    const height = window.innerHeight * 0.90;
    const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
    camera.position.set(3, 2, 5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(width, height);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.enableZoom = true;
    controls.minDistance = 2;
    controls.maxDistance = 50;
    controls.enablePan = true;
    controls.enableRotate = true;
    controls.mouseButtons = {
      LEFT: THREE.MOUSE.ROTATE,
      MIDDLE: THREE.MOUSE.DOLLY,
      RIGHT: THREE.MOUSE.PAN
    };

    scene.add(new THREE.AmbientLight(0x404040, 1.5));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(20, 20),
      new THREE.MeshStandardMaterial({ color: 0xcccccc })
    );
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    const colMat = new THREE.MeshStandardMaterial({ color: 0x888888 });
    [-4, 4].forEach(x => {
      [-4, 4].forEach(z => {
        const col = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 3, 16), colMat);
        col.position.set(x, 1.5, z);
        scene.add(col);
      });
    });

    const boxGeometry = new THREE.BoxGeometry(1, 1, 1);
    const boxMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
    const box = new THREE.Mesh(boxGeometry, boxMaterial);
    box.position.set(0, 0.5, 0);
    scene.add(box);

    const loader = new GLTFLoader();
    loader.load(
      './test_box.gltf', // html 파일과 같은 폴더에 넣어둠
      gltf => {
        scene.add(gltf.scene);
      },
      undefined,
      error => {
        console.error('모델 로딩 오류:', error);
      }
    );

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      const width = window.innerWidth * 0.95;
      const height = window.innerHeight * 0.90;
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height);
    });

    // 팝업 관련 JS
    const settingsBtn = document.getElementById('settings-btn');
    const settingsPopup = document.getElementById('settings-popup');
    const closePopup = document.getElementById('close-popup');

    settingsBtn.addEventListener('click', () => {
      settingsPopup.style.display = 'flex';
    });
    closePopup.addEventListener('click', () => {
      settingsPopup.style.display = 'none';
    });
  </script>
</body>
</html>
